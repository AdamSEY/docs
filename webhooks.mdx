---
title: "Webhooks"
description: "Receive real-time notifications for events in your Migma account"
---

## Overview

Webhooks allow you to receive real-time HTTP notifications when events occur in your Migma account. Instead of polling for updates, your application receives instant POST requests to your specified endpoint.

## Getting Started

### 1. Create a Webhook Endpoint

First, set up an HTTPS endpoint on your server to receive webhook events:

```javascript
const express = require('express');
const crypto = require('crypto');

app.post('/webhooks/migma', express.json(), (req, res) => {
  // Verify signature (see security section)
  const signature = req.headers['x-migma-signature'];

  // Process the event
  const event = req.body;
  console.log(`Received ${event.type}:`, event.data);

  // Return 200 to acknowledge receipt
  res.sendStatus(200);
});
```

### 2. Register Your Webhook

Register your endpoint through the Migma dashboard or API:

- Navigate to **Settings → API Integration → Webhooks tab**
- Click **Create Webhook**
- Enter your endpoint URL
- Select the events you want to receive
- Save and copy your webhook secret

## Available Events

### Email Generation

| Event | Description |
|-------|-------------|
| `email.generation.started` | Email generation has begun |
| `email.generation.completed` | Email was successfully generated |
| `email.generation.failed` | Email generation encountered an error |

### Project Import

| Event | Description |
|-------|-------------|
| `project.import.started` | Project import has begun |
| `project.import.processing` | Project is being processed |
| `project.import.completed` | Project import finished successfully |
| `project.import.failed` | Project import encountered an error |

### Exports

| Event | Description |
|-------|-------------|
| `export.completed` | Email export completed successfully |
| `export.failed` | Email export encountered an error |

### Subscribers

| Event | Description |
|-------|-------------|
| `subscriber.added` | New subscriber was added |
| `subscriber.updated` | Subscriber information was updated |
| `subscriber.unsubscribed` | Subscriber unsubscribed |
| `subscriber.bulk_imported` | Bulk import of subscribers completed |

### API Keys

| Event | Description |
|-------|-------------|
| `api_key.created` | New API key was created |
| `api_key.revoked` | API key was revoked |

## Webhook Payload Structure

All webhook events follow this structure:

```json
{
  "id": "evt_1234567890abcdef",
  "type": "email.generation.completed",
  "timestamp": "2024-09-30T12:34:56.789Z",
  "data": {
    // Event-specific data
  },
  "metadata": {
    "projectId": "proj_abc123",
    "conversationId": "conv_xyz789"
  }
}
```

### Example: Email Generation Completed

```json
{
  "id": "evt_a1b2c3d4e5f6",
  "type": "email.generation.completed",
  "timestamp": "2024-09-30T12:34:56.789Z",
  "data": {
    "conversationId": "conv_xyz789",
    "projectId": "proj_abc123",
    "subject": "Welcome to Our Newsletter",
    "generationTime": 3245,
    "wordCount": 428
  },
  "metadata": {
    "projectId": "proj_abc123",
    "conversationId": "conv_xyz789"
  }
}
```

## Security

### Verifying Webhook Signatures

Every webhook includes an `X-Migma-Signature` header with an HMAC SHA-256 signature. **Always verify this signature** to ensure the request came from Migma.

#### Node.js Example

```javascript
const crypto = require('crypto');

function verifyWebhookSignature(payload, signature, secret) {
  const computedSignature = crypto
    .createHmac('sha256', secret)
    .update(JSON.stringify(payload))
    .digest('hex');

  return crypto.timingSafeEqual(
    Buffer.from(signature),
    Buffer.from(computedSignature)
  );
}

app.post('/webhooks/migma', express.json(), (req, res) => {
  const signature = req.headers['x-migma-signature'];
  const isValid = verifyWebhookSignature(req.body, signature, process.env.MIGMA_WEBHOOK_SECRET);

  if (!isValid) {
    return res.status(401).send('Invalid signature');
  }

  // Process the webhook
  res.sendStatus(200);
});
```

#### Python Example

```python
import hmac
import hashlib
import json

def verify_webhook_signature(payload, signature, secret):
    computed_signature = hmac.new(
        secret.encode(),
        json.dumps(payload).encode(),
        hashlib.sha256
    ).hexdigest()

    return hmac.compare_digest(signature, computed_signature)

@app.route('/webhooks/migma', methods=['POST'])
def webhook():
    signature = request.headers.get('X-Migma-Signature')
    payload = request.get_json()

    if not verify_webhook_signature(payload, signature, os.getenv('MIGMA_WEBHOOK_SECRET')):
        return 'Invalid signature', 401

    # Process the webhook
    return '', 200
```

## Best Practices

### Idempotency

Use the event `id` to ensure you don't process the same event twice:

```javascript
const processedEvents = new Set();

app.post('/webhooks/migma', async (req, res) => {
  const eventId = req.body.id;

  if (processedEvents.has(eventId)) {
    return res.sendStatus(200); // Already processed
  }

  // Process event
  await handleEvent(req.body);

  processedEvents.add(eventId);
  res.sendStatus(200);
});
```

### Response Quickly

Respond with `200 OK` immediately, then process the webhook asynchronously:

```javascript
app.post('/webhooks/migma', (req, res) => {
  // Acknowledge receipt immediately
  res.sendStatus(200);

  // Process asynchronously
  processWebhookAsync(req.body).catch(err => {
    console.error('Webhook processing error:', err);
  });
});
```

### Retry Logic

Migma automatically retries failed webhook deliveries:
- **1st retry**: After 1 minute
- **2nd retry**: After 5 minutes
- **3rd retry**: After 15 minutes

Return `200-299` status codes to indicate success. Any other status code (or timeout) triggers a retry.

### Error Handling

```javascript
app.post('/webhooks/migma', async (req, res) => {
  try {
    // Verify signature
    if (!verifySignature(req)) {
      return res.status(401).send('Invalid signature');
    }

    // Process event
    await handleEvent(req.body);

    res.sendStatus(200);
  } catch (error) {
    console.error('Webhook error:', error);

    // Return 500 to trigger retry
    res.status(500).send('Processing failed');
  }
});
```

## Testing

### Test Your Webhook

You can test your webhook endpoint from the Migma dashboard:

1. Go to **Settings → API Integration → Webhooks**
2. Find your webhook in the list
3. Click the test icon (🔄)
4. Check your endpoint receives the test payload

### Local Development

Use tools like [ngrok](https://ngrok.com) to expose your local server:

```bash
ngrok http 3000
```

Then register the ngrok URL as your webhook endpoint.

## Monitoring

### View Delivery History

Monitor webhook deliveries in the dashboard:
- Click the clock icon next to any webhook
- View delivery attempts, response codes, and timing
- Debug failed deliveries

### Success Rates

Track webhook health with success rate metrics shown for each webhook in the dashboard.

## Troubleshooting

### Common Issues

| Issue | Solution |
|-------|----------|
| Signature verification fails | Ensure you're using the correct secret and computing the signature over the raw request body |
| Timeouts | Respond with 200 immediately, process asynchronously |
| Duplicate events | Implement idempotency using event IDs |
| Missing events | Check your endpoint returns 200-299 status codes |

### Debug Mode

Enable verbose logging to troubleshoot:

```javascript
app.post('/webhooks/migma', (req, res) => {
  console.log('Headers:', req.headers);
  console.log('Body:', req.body);
  console.log('Signature:', req.headers['x-migma-signature']);

  // ... rest of your code
});
```

## Rate Limits

Webhook endpoints should handle:
- **Up to 100 requests per second** during high activity
- **Burst traffic** from batch operations (e.g., bulk imports)

Ensure your endpoint can scale appropriately.

## Support

Need help with webhooks?
- 📚 [API Reference](/api-reference/introduction)
- 💬 [Contact Support](https://migma.ai/support)
- 🐛 [Report Issues](https://github.com/migma/issues)